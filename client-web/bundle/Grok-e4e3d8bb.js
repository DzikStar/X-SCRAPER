"use strict";
(self.webpackChunk_twitter_responsive_web = self.webpackChunk_twitter_responsive_web || []).push([
    ["bundle.Grok-e4e3d8bb"],
    {
        839090: (e, o, r) => {
            r.d(o, { Z: () => a });
            r(202784);
            const a = (0, r(523561).Z)({
                loader: () =>
                    Promise.all([
                        r.e("icons.2"),
                        r.e("icons.24"),
                        r.e("icons.10"),
                        r.e("icons.15"),
                        r.e("icons.27"),
                        r.e("icons.16"),
                        r.e("icons.12"),
                        r.e("icons.7"),
                        r.e("icons.5"),
                        r.e("icons.22"),
                        r.e("icons.19"),
                        r.e("icons.17"),
                        r.e("icons.26"),
                        r.e("icons.4"),
                        r.e("icons.29"),
                        r.e("modules.common-e907d115"),
                        r.e("modules.common-e019dbda"),
                        r.e("icons.14"),
                        r.e("shared~loader.AudioDock~loader.Dock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.Inline-4dc04b0b"),
                        r.e("shared~loader.AudioDock~loader.Dock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.Inline-f75f2a40"),
                        r.e("shared~loader.AudioDock~loader.Dock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.Inline-9b450461"),
                        r.e("shared~loader.AudioDock~loader.Dock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.Inline-abff603b"),
                        r.e("shared~loader.AudioDock~loader.Dock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.Inline-cdbf42c1"),
                        r.e("shared~loader.AudioDock~loader.Dock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.Inline-c94903fb"),
                        r.e("shared~loader.AudioDock~loader.Dock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.Inline-7cff528b"),
                        r.e("shared~loader.AudioDock~loader.Dock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.Inline-fc31ced1"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-2078c561"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-676e3eb1"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-ae204d10"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-f0be4555"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-a8f633cf"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-9bd28fed"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-6a872481"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-9b130c11"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-78c7e6e6"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-3fe805ff"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-647e57f3"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-885c42d5"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-7082ec04"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-fd0b2cf1"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-c7e58553"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-f7f56781"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-ff4a34e0"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-db3d5daf"),
                        r.e("shared~loader.AudioDock~loader.DashMenu~loader.DashModal~loader.DMDrawer~ondemand.InlinePlayer~ondem-2d219c28"),
                        r.e("shared~loader.Typeahead~loader.AppModules~loader.DMDrawer~ondemand.HoverCard~ondemand.NotFound~bundle.AboutTh"),
                        r.e("shared~loader.Typeahead~loader.DMDrawer~ondemand.HoverCard~bundle.ReaderMode~bundle.AudioSpacePeek~bundle.Bir"),
                        r.e("shared~bundle.JobSearch~bundle.UserJobs~loader.WideLayout"),
                        r.e("loader.WideLayout-6107ac1a"),
                        r.e("loader.WideLayout-9f4db315"),
                    ]).then(r.bind(r, 616753)),
            });
        },
        207137: (e, o, r) => {
            r.d(o, { BC: () => l, FI: () => i, Pm: () => n, gO: () => s, zk: () => t });
            const a = () => new Date(Date.now());
            function t(e, o = a()) {
                return o.getFullYear() === e.getFullYear() && o.getMonth() === e.getMonth() && o.getDate() === e.getDate();
            }
            function s(e, o = a()) {
                const r = new Date(o);
                return r.setHours(r.getHours() - 24), t(e, r);
            }
            function n(e, o = a()) {
                const r = new Date(o);
                return r.setHours(r.getHours() + 24), t(e, r);
            }
            const d = 6048e5;
            function i(e, o = a()) {
                const r = o - e;
                return r >= 0 && r <= d;
            }
            function l(e, o) {
                const r = new Date();
                return o < r || o < e ? 0 : Math.min(1, (r - e) / (o - e));
            }
        },
        128225: (e, o, r) => {
            r.d(o, { f: () => a });
            r(543673), r(240753), r(128399), r(571372);
            const a = (e, o = !1, r = !1) =>
                new Promise((a, t) => {
                    const s = new URL(e);
                    r && !e.startsWith("blob:") && s.searchParams.set("grok_timestamp", Date.now().toString());
                    const n = new window.XMLHttpRequest();
                    (n.responseType = "blob"),
                        (n.onreadystatechange = () => {
                            n.readyState === window.XMLHttpRequest.DONE && (200 === n.status ? a(n.response) : t(new Error("Unexpected status code")));
                        }),
                        (n.withCredentials = o),
                        (n.onerror = (e) => t(e)),
                        (n.ontimeout = (e) => t(e)),
                        n.open("GET", s.toString(), !0),
                        n.send();
                });
        },
        646403: (e, o, r) => {
            r.d(o, { E: () => t });
            var a = r(420182);
            const t = ({ analytics: e, jotaiStore: o, query: r, responseAtom: t }) => {
                const s = o.get(a.dd);
                let n = "";
                return (
                    s.fetchClient
                        .dispatch("/2/grok/search.json", { method: "POST", credentials: "include", body: JSON.stringify({ query: r }) })
                        .then(async (e) => {
                            if (!e.ok) return void o.set(t, (e) => ({ ...e, status: "error" }));
                            const r = e.body?.getReader();
                            if (!r) return void o.set(t, (e) => ({ ...e, status: "error" }));
                            const a = new TextDecoder();
                            let s = "";
                            return (async function e({ done: d, value: i }) {
                                const l = o.get(t);
                                if (d) n ? o.set(t, (e) => ({ ...e, status: "completed" })) : o.set(t, (e) => ({ ...e, status: "error" }));
                                else if (i) {
                                    const d = a.decode(i);
                                    if (((s += d), s.includes("\n"))) {
                                        const e = s.split("\n");
                                        s = e.pop();
                                        for (const r of e)
                                            try {
                                                const e = JSON.parse(r);
                                                "error" === e.result?.responseType && o.set(t, { ...l, status: "error" }), e.result?.event?.universalSearch?.decision && o.set(t, (e) => ({ ...e, status: "streaming" }));
                                                const a = e.result?.event?.universalSearch?.id;
                                                a && o.set(t, (e) => ({ ...e, universalSearchId: a }));
                                                const s = e.result?.citedWebResults;
                                                s && s.length > 0 && o.set(t, (e) => ({ ...e, citedWebResults: s }));
                                                const d = e.result?.followUpSuggestions;
                                                d && o.set(t, (e) => ({ ...e, followUpSuggestions: d })), e.result?.message && !e.result?.postIds && (n += e.result?.message);
                                                const i = e.result?.imageAttachment;
                                                i && o.set(t, (e) => ({ ...e, fileAttachments: [...e.fileAttachments, { fileName: i.fileName, mimeType: i.mimeType, url: i.imageUrl, mediaId: i.mediaIdStr }] }));
                                            } catch (e) {}
                                    }
                                    if ((o.set(t, (e) => ({ ...e, text: n })), r)) {
                                        return e(await r.read());
                                    }
                                }
                            })(await r.read());
                        })
                        .catch((e) => {
                            o.set(t, (o) => ({ ...o, status: "completed", error: e.toString() }));
                        }),
                    t
                );
            };
        },
        309401: (e, o, r) => {
            r.d(o, { T: () => h, Z: () => m });
            r(136728), r(875640);
            var a = r(565058),
                t = r(323265),
                s = r(834949),
                n = r.n(s),
                d = r(420182),
                i = r(155918),
                l = r(623494),
                c = r(397159),
                u = r(774717);
            class m {
                constructor() {
                    (this.prompt = (0, a.cn)("")), (this.status = (0, a.cn)("idle")), (this.message = (0, a.cn)("")), (this.fileAttachments = (0, a.cn)([])), (this.upsell = (0, a.cn)(null));
                }
            }
            class h extends m {
                constructor(e) {
                    super(), (this.abortController = new AbortController()), (this.imageGenerationCount = 1), (this.conversationId = ""), (this.promptSource = "NATURAL"), (this._store = e);
                }
                abort() {
                    this.abortController.abort();
                }
                updateUpsell(e) {
                    this._store.set(this.upsell, e);
                }
                clearAttachments() {
                    this._store.set(this.fileAttachments, []);
                }
                updatePrompt(e) {
                    this._store.set(this.prompt, e);
                }
                updateMessage(e) {
                    this._store.set(this.message, e);
                }
                updateState(e) {
                    this._store.set(this.status, e);
                }
                addImageAttachmentUpdate(e) {
                    const o = { ...e };
                    this._store.set(this.fileAttachments, (r) => {
                        const a = [...r];
                        let t = !1;
                        for (let r = 0; r < a.length; r++)
                            if ((!a[r].imageId && !a[r].url) || a[r].imageId === e.imageIdStr) {
                                (a[r].imageId = o.imageIdStr), a[r].intermediateResults ? (a[r].intermediateResults = a[r].intermediateResults.concat([o])) : (a[r].intermediateResults = [o]), (t = !0);
                                break;
                            }
                        return t || a.push({ fileName: "image", mimeType: "image/jpeg", url: void 0, imageId: o.imageIdStr, intermediateResults: [o] }), a;
                    });
                }
                addAttachment(e) {
                    this._store.set(this.fileAttachments, (o) => {
                        const r = [...o];
                        let a = !1;
                        for (let o = 0; o < r.length; o++)
                            if ((!r[o].url && !r[o].imageId) || r[o].url === e.url || (e.url && r[o].imageId && e.url.includes(r[o].imageId))) {
                                (r[o] = { ...r[o], url: e.url, fileName: e.fileName, mimeType: e.mimeType }), (a = !0);
                                break;
                            }
                        return a || r.push({ ...e }), r;
                    });
                }
                setAttachmentCount(e) {
                    this._store.set(this.fileAttachments, (o) => {
                        if (o.length === e) return o;
                        const r = [...o];
                        let a = r.length;
                        for (r.length = Math.max(e, r.length); a < e; a++) r[a] = { imageId: "", fileName: "image", mimeType: "image/jpeg", url: void 0 };
                        return r;
                    });
                }
                async generate({ analytics: e, prompt: o }) {
                    (this.abortController = new AbortController()), this._store.set(this.fileAttachments, []);
                    const r = { message: this._store.get(this.prompt) ?? "", sender: i.CI.HUMAN },
                        a = this._store.get(d.dd);
                    if (!("POST_COMPOSER_IMAGE_GEN" === this.promptSource || "POST_COMPOSER_TEXT_GEN" === this.promptSource) && !this.conversationId) {
                        const o = await a.apiClient.graphQL(n(), {});
                        if (((this.conversationId = o.create_grok_conversation?.conversation_id || ""), !this.conversationId)) return void (0, l.Uk)(e, "conversation couln't be found or created");
                    }
                    const s = this.userChatItemId ? "REGENERATE" : "INPUT";
                    let c;
                    (c = "POST_COMPOSER_IMAGE_GEN" === this.promptSource ? { promptSource: "POST_COMPOSER_IMAGE_GEN", action: s } : "POST_COMPOSER_TEXT_GEN" === this.promptSource ? { promptSource: "POST_COMPOSER_TEXT_GEN", action: s } : { promptSource: "NATURAL", action: s }), o && o.toolOverrides && (this.toolOverrides = o.toolOverrides);
                    const u = { responses: [r], conversationId: this.conversationId || void 0, grokModelOptionId: this.model || "", systemPromptName: "", imageGenerationCount: this.imageGenerationCount, promptMetadata: c, resampleResponseId: this.userChatItemId, toolOverrides: this.toolOverrides || {} };
                    (0, l.pv)(e, { conversationLength: 1, isFileAttached: !1 }), this.updateMessage(""), o && o.onStart && o.onStart();
                    const m = this._store.get(d.f0),
                        h = !t.ZP.isTwitterApp() && m.isTrue("responsive_web_grok_api_enable_grok_host");
                    p({ api: a, analytics: e, requestBody: u, atoms: this, eventTag: this.userChatItemId ? "regenerate" : "", enableGrokApiHost: h });
                }
            }
            const p = ({ analytics: e, api: o, atoms: r, enableGrokApiHost: a, eventTag: s, requestBody: n }) => {
                const d = (function () {
                        const e = `grok-${t.ZP.isTwitterApp() ? (t.ZP.isAndroid() ? "android" : "ios") : "web"}:api-handler`,
                            o = u.P_();
                        function r(r) {
                            u.IM(`${e}:${r}`, o.end());
                        }
                        const a = new Set();
                        function s(e) {
                            a.has(e) || (a.add(e), r(e));
                        }
                        return { record: r, recordOnce: s };
                    })(),
                    i = s ? ` (${s})` : "";
                let m = "",
                    h = !1;
                return (
                    r.updateState("loading"),
                    o.fetchClient
                        .dispatch("/2/grok/add_response.json", { method: "POST", credentials: "include", body: JSON.stringify(n), signal: r.abortController?.signal }, a ? "https://grok.x.com" : void 0)
                        .then(async (o) => {
                            if (!o.ok) return d.record(`http-${o.status}`), r.updateState("error"), void (0, l.Uk)(e, `add-response failed with status ${o.status}${i}`);
                            const a = o.body?.getReader();
                            if (!a) return r.updateState("error"), void (0, l.Uk)(e, `reader was not found${i}`);
                            r.updateState("streaming");
                            const t = new TextDecoder();
                            let s = "";
                            const u = setTimeout(() => {
                                    (0, l.eS)(e, !0);
                                }, 5e3),
                                p = await a.read();
                            return (
                                clearTimeout(u),
                                (async function o({ done: u, value: p }) {
                                    if (u) m || h ? (r.updateState("complete"), d.record("time-to-last-chunk")) : (r.updateState("error"), (0, l.Uk)(e, `add-response failed to reach the network${i}`), d.record("network-error"));
                                    else if (p) {
                                        d.recordOnce("time-to-first-chunk");
                                        const i = t.decode(p);
                                        if (((s += i), s.includes("\n"))) {
                                            const o = s.split("\n");
                                            s = o.pop();
                                            for (const a of o)
                                                try {
                                                    const e = JSON.parse(a);
                                                    if ((e.userChatItemId && (r.userChatItemId = e.userChatItemId), e.result?.upsell && r.updateUpsell(e.result.upsell), e.result?.postIds || !e.result?.message || e.result?.isThinking || (e.result?.messageTag && e.result?.messageTag !== c.iS.FINAL) || ((m += e.result.message), r.updateMessage(m)), "error" === e.result?.responseType && r.clearAttachments(), e.result?.imageAttachmentCount)) {
                                                        let o = e.result.imageAttachmentCount;
                                                        n.imageGenerationCount && (o = Math.min(o, n.imageGenerationCount)), r.setAttachmentCount(o);
                                                    }
                                                    const o = e.result?.event;
                                                    if ((o && o.imageAttachmentUpdate && ((h = !0), r.addImageAttachmentUpdate({ imageIdStr: o.imageAttachmentUpdate.imageIdStr, imageId: o.imageAttachmentUpdate.imageId, progress: o.imageAttachmentUpdate.progress / 100, imageUrl: o.imageAttachmentUpdate.imageUrl })), "image" === e.result?.responseType || e.result?.imageAttachment?.imageUrl)) {
                                                        h = !0;
                                                        const o = { fileName: "image", mimeType: "image/jpeg", url: e.result.imageAttachment?.imageUrl ?? void 0 };
                                                        r.addAttachment(o);
                                                    }
                                                } catch (o) {
                                                    (0, l.kl)(e, o, { json: a });
                                                }
                                        }
                                        if (a) {
                                            const r = setTimeout(() => {
                                                    (0, l.eS)(e, !1);
                                                }, 5e3),
                                                t = await a.read();
                                            return clearTimeout(r), o(t);
                                        }
                                    }
                                })(p)
                            );
                        })
                        .catch((o) => {
                            o instanceof window.DOMException && "AbortError" === o.name ? d.record("abort") : ((0, l.kl)(e, o), d.record("error")), r.updateState("error");
                        })
                );
            };
        },
        965728: (e, o, r) => {
            r.d(o, { C_: () => f, I5: () => p, K2: () => g, L$: () => l, Rb: () => D, nk: () => h, sI: () => _, xr: () => M });
            var a = r(202784),
                t = r(483677),
                s = r(782578),
                n = r(393058),
                d = r(521514);
            const i = (e, o) => `rgba(${e.rgb.red}, ${e.rgb.green}, ${e.rgb.blue}, ${o})`,
                l = (e) => {
                    const o = e && t.Z.getForGallery(e);
                    return o ? { rgb: M(o), rgba: i(o, 0.9) } : m;
                },
                c = d.Z.columnWidths.primary,
                u = (e, o) => Math.min(o, e),
                m = { rgb: "rgb(0, 0, 0)", rgba: "rgba(0, 0, 0, 0.9)" },
                h = { transitionProperty: "background-color", transitionDuration: ".5s" },
                p = (e, o) => {
                    const { containerHeight: r, containerWidth: a, mediaHeight: t, mediaWidth: n } = e,
                        d = n && t ? n / t : 1,
                        i = d > 1,
                        l = o ? 400 : c,
                        m = i && (!n || n <= l) ? u(a, l) : a,
                        h = i || (t && !(t <= l)) ? r : u(r, l);
                    return s.Z.getContainDimensions({ width: m, height: h }, d);
                },
                D = (e) => {
                    const o = e && e.ext_media_color && e.ext_media_color.palette;
                    return l(o);
                },
                g = (e) => {
                    const o = e && e.profile_image_extensions_media_color && e.profile_image_extensions_media_color.palette;
                    return l(o);
                },
                f = (e) => {
                    const o = e && e.profile_banner_extensions_media_color && e.profile_banner_extensions_media_color.palette;
                    return l(o);
                },
                M = (e) => `rgb(${e.rgb.red}, ${e.rgb.green}, ${e.rgb.blue})`,
                b = (e, o) => {
                    switch (o.type) {
                        case "zoom":
                            return { ...e, isZoomed: o.payload.isZoomed, showControls: !o.payload.isZoomed };
                        case "tap":
                            return { ...e, showControls: !e.showControls };
                        default:
                            return e;
                    }
                },
                _ = () => {
                    const [e, o] = a.useReducer(b, { isZoomed: !1, showControls: !0 });
                    return {
                        hideButtons: e.isZoomed || !e.showControls,
                        handleMediaDetailZoomed: function (e) {
                            o({ type: "zoom", payload: { isZoomed: e } });
                        },
                        handleMediaItemTapped: function () {
                            n.Z.isTouchSupported() && o({ type: "tap" });
                        },
                    };
                };
        },
        584770: (e, o, r) => {
            r.d(o, { Z: () => n });
            var a = r(202784),
                t = r(443781),
                s = r(337394);
            const n = () => {
                const { userClaims: e } = a.useContext(t.rC);
                return !s.cX.some((o) => e.hasSubscription(o)) && (e.hasSubscription("premium_standard") || e.hasSubscription("premium_basic"));
            };
        },
        15334: (e, o, r) => {
            r.d(o, { u: () => s });
            var a = r(202784),
                t = r(443781);
            const s = () => {
                const { userClaims: e } = a.useContext(t.rC);
                return e.hasSubscription("verified_org_full_access") || e.hasSubscription("verified_org_basic") || e.hasSubscription("verified_org_free") || e.hasSubscription("verified_org_gov_paid") || e.hasSubscription("verified_org_gov_paid") || e.hasSubscription("verified_org_legacy") || e.hasSubscription("verified_org_affiliate") || e.hasSubscription("verified_org_gov_affiliate") || e.hasSubscription("premium_plus") ? "premium_plus" : e.hasSubscription("premium_standard") ? "premium_standard" : e.hasSubscription("premium_basic") ? "premium_basic" : "free";
            };
        },
    },
]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/bundle.Grok-e4e3d8bb.c69a0d8a.js.map
